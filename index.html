<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>365 Dni Koktajli Sezonowych - Tracker</title>
    <!-- ≈Åadowanie Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Definicje niestandardowych kolor√≥w i styl√≥w dla estetyki */
        :root {
            --color-primary: #059669; /* Emerald Green */
            --color-secondary: #064E3B; /* Darker Emerald */
            --color-text: #1F2937;
            --color-bg-light: #F9FAFB;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-light);
            color: var(--color-text);
        }

        /* Utrzymanie nag≈Ç√≥wka na g√≥rze */
        .sticky-header {
            top: 0;
            z-index: 20;
        }

        /* --- Custom Checkbox (Stylizacja dla lepszej interakcji dotykowej) --- */
        .checkbox-container {
            display: block;
            position: relative;
            cursor: pointer;
            width: 28px;
            height: 28px;
        }

        .checkbox-container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        /* Stylizacja kwadratowego znacznika */
        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 28px;
            width: 28px;
            border-radius: 8px; 
            background-color: #E5E7EB; 
            transition: all 0.2s;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 2px solid #D1D5DB;
        }

        .checkbox-container:hover input ~ .checkmark {
            background-color: #D1FAE5; 
        }

        /* Kolor, gdy checkbox jest zaznaczony (zmieni siƒô dynamicznie przez JS/Tailwind) */
        .checkbox-container input:checked ~ .checkmark {
            background-color: var(--color-primary);
            border-color: var(--color-primary);
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
        }

        /* Stylizacja znacznika 'ptaszka' */
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        /* Poka≈º znacznik po zaznaczeniu */
        .checkbox-container input:checked ~ .checkmark:after {
            display: block;
        }

        /* Stylizacja samego 'ptaszka' (bia≈Çy) */
        .checkbox-container .checkmark:after {
            left: 9px;
            top: 5px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }

        /* Karta po uko≈Ñczeniu */
        .shake-card.completed {
            background-color: #F0FFF4; 
            opacity: 0.85;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        /* Styl szczeg√≥≈Ç√≥w (ukryte domy≈õlnie) */
        .shake-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
            padding: 0 1rem;
        }
        
        /* Styl szczeg√≥≈Ç√≥w po otwarciu */
        .shake-card.open .shake-details {
            max-height: 200px; 
            padding-bottom: 1rem;
            padding-top: 0.5rem;
        }
        
        .shake-card.today {
            /* Dodatkowy styl dla dzisiejszego dnia */
            border: 4px solid;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            animation: pulse-border 1.5s infinite alternate;
        }

        /* Animacja delikatnego pulsowania ramki dla dzisiejszego dnia */
        @keyframes pulse-border {
            0% { border-color: rgba(5, 150, 105, 0.4); }
            100% { border-color: rgba(5, 150, 105, 1); }
        }
    </style>
</head>
<body class="selection:bg-green-200">

    <div id="app" class="max-w-xl mx-auto min-h-screen">

        <!-- Nag≈Ç√≥wek i Status -->
        <header class="bg-gradient-to-r from-emerald-500 to-teal-500 text-white p-6 shadow-2xl rounded-b-3xl mb-6 sticky-header">
            <a href="index.html" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white/90 hover:text-white transition duration-200 text-sm font-semibold p-2 rounded-lg">
                ‚Üê Home
            </a>
            <h1 class="text-3xl font-extrabold text-center mb-1 drop-shadow-md">üåø 365 Dni Zielonej Mocy</h1>
            <p class="text-sm text-center opacity-90 mb-4">Wyzwanie Sezonowe: Uko≈Ñcz 100% kwarta≈Çu!</p>
            <div id="progress-display" class="text-center font-semibold bg-white/20 backdrop-blur-sm rounded-full py-1 text-sm shadow-inner transition duration-500">
                ≈Åadowanie postƒôpu...
            </div>
        </header>

        <!-- Wyzwanie Sezonowe -->
        <div id="challenge-display" class="bg-white mx-4 p-4 rounded-xl shadow-lg border-t-4 border-emerald-500 mb-6 transition-all duration-300">
             <!-- Tre≈õƒá zostanie za≈Çadowana dynamicznie -->
        </div>
        
        <!-- Przycisk Resetowania Danych -->
        <div class="px-4 mb-4">
            <button onclick="confirmReset()" class="w-full bg-red-100 text-red-700 hover:bg-red-200 transition-colors duration-200 p-2 text-sm font-medium rounded-lg shadow-sm">
                Resetuj wszystkie postƒôpy
            </button>
        </div>


        <!-- Przyciski Kwarta≈Ç√≥w (Tabs) -->
        <div id="quarter-buttons" class="flex justify-between space-x-2 px-4 mb-6">
            <!-- Przyciski zostanƒÖ wygenerowane dynamicznie przez JS -->
        </div>
        
        <p id="filter-status" class="text-center text-sm font-medium text-gray-500 mb-4 transition-opacity duration-300">
            Poka≈º wszystkie 365 dni.
        </p>

        <!-- Kontener dla listy Koktajli -->
        <div class="px-4 pb-12" id="shake-list">
            <!-- Lista koktajli zostanie wygenerowana dynamicznie przez JS -->
        </div>

    </div>

    <!-- Niestandardowy Modal (Zastƒôpuje alert/confirm) -->
    <div id="custom-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" onclick="closeModal()">
        <div class="bg-white rounded-xl p-6 shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-95" onclick="event.stopPropagation()">
            <h3 id="modal-title" class="text-xl font-bold mb-3 text-gray-800">Potwierd≈∫ Akcjƒô</h3>
            <p id="modal-message" class="text-gray-600 mb-6">Czy na pewno chcesz zresetowaƒá wszystkie postƒôpy? Ta akcja jest nieodwracalna.</p>
            <div class="flex justify-end space-x-3">
                <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition-colors">Anuluj</button>
                <button id="modal-confirm-btn" class="px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors">Potwierd≈∫</button>
            </div>
        </div>
    </div>

    <script>
        // --- Dane Planu Koktajlowego (365 Dni, 4 Kwarta≈Çy) ---

        // Kwarta≈Ç 1: ZIMA (Listopad - Stycze≈Ñ) - Cel: Wzmocnienie
        const ZIMA = [
            { name: "Zimowy Wojownik (Imbir/Kurkuma)", ingredients: "Mro≈ºone Mango, Kurkuma, Imbir, Czarny Pieprz, Mleko Owiane.", focus: "Odporno≈õƒá" },
            { name: "Cytrusowa Tarcza (Witamina C)", ingredients: "Pomara≈Ñcza, Mandarynka, 1/2 Banana, Siemiƒô Lniane, Woda.", focus: "Odporno≈õƒá" },
            { name: "Zielone Paliwo (Antyoksydanty)", ingredients: "Mro≈ºony Jarmu≈º/Szpinak, Jab≈Çko, Cynamon, Nasiona Chia, Woda.", focus: "Wzmocnienie" },
            { name: "RozgrzewajƒÖcy Owsiany", ingredients: "P≈Çatki Owsiane (namoczone), Mas≈Ço Orzechowe, Banan, Mleko, Szczypta Kakao.", focus: "Energia" },
            { name: "Czerwona Si≈Ça Buraka", ingredients: "Ugotowany Burak, Jab≈Çko, Mro≈ºone Wi≈õnie, Imbir, Sok z Cytryny.", focus: "Detoks" },
            { name: "Bomba Bia≈Çkowa z Nasion", ingredients: "Szpinak, Mleko Migda≈Çowe, Od≈ºywka Bia≈Çkowa (lub Tofu), Pestki Dyni, 1/2 Gruszki.", focus: "Bia≈Çko" },
            { name: "Jagodowy Power (Mro≈ºone)", ingredients: "Mieszanka Mro≈ºonych Jag√≥d, Jogurt Naturalny, Mi√≥d, Woda.", focus: "Antyoksydanty" },
            { name: "Kawa na Czyste My≈õlenie", ingredients: "Kawa Parzona na Zimno, Mleko Kokosowe, Cynamon, 1 ≈Åy≈ºeczka Oleju MCT.", focus: "Focus" },
            { name: "Miodowo-Czosnkowy (Naturalny Antybiotyk)", ingredients: "Banan, Mi√≥d, Woda, 1/4 ZƒÖbka Czosnku (opcjonalnie!), Pomara≈Ñcza.", focus: "Odporno≈õƒá" },
            { name: "Koktajl z P≈Çatkami ≈ªytnimi", ingredients: "P≈Çatki ≈ªytnie, Siemiƒô Lniane, Mleko Ry≈ºowe, Jab≈Çko, Cynamon.", focus: "B≈Çonnik" },
            { name: "Kremowy Banan i Kakao", ingredients: "Banan, Kakao Naturalne, Mleko Owiane, 1 ≈Åy≈ºeczka Mas≈Ça Migda≈Çowego.", focus: "Uspokojenie" },
            { name: "Koktajl z KiszonƒÖ KapustƒÖ (Probiotyki)", ingredients: "Ma≈Ça ilo≈õƒá soku z Kiszonej Kapusty, Og√≥rek, Jab≈Çko, Szpinak, Woda.", focus: "Jelita" },
            { name: "Mro≈ºona Gruszka i Kardamon", ingredients: "Mro≈ºona Gruszka, Kardamon, Mleko Migda≈Çowe, 1/2 Banana.", focus: "Rozgrzewanie" },
            { name: "Wyb√≥r Tygodnia (Dzie≈Ñ Wolny)", ingredients: "Wybierz dowolny ulubiony koktajl z kwarta≈Çu 1.", focus: "Regeneracja" },
        ]; // 14 unikalnych

        // Kwarta≈Ç 2: WIOSNA (Luty - Kwiecie≈Ñ) - Cel: Oczyszczanie
        const WIOSNA = [
            { name: "Zielony Detoks (Chlorofil)", ingredients: "≈öwie≈ºy Og√≥rek, M≈Çody Szpinak, Kiwi, Sok z Limonki, Woda Kokosowa.", focus: "Detoks" },
            { name: "Wiosenna Odnowa z PokrzywƒÖ", ingredients: "≈öwie≈ºa lub Mro≈ºona Pokrzywa, Jab≈Çko, Banan, Siemiƒô Lniane.", focus: "Oczyszczanie" },
            { name: "B≈Çonnikowa Moc Chia i Kie≈Çk√≥w", ingredients: "Mleko Migda≈Çowe, Banan, Nasiona Chia, ≈Åy≈ºka Kie≈Çk√≥w Broku≈Ça.", focus: "B≈Çonnik" },
            { name: "Grejpfrutowy Spalacz T≈Çuszczu", ingredients: "Grejpfrut, Pomara≈Ñcza, Odrobina Imbiru, Li≈õcie Miƒôty.", focus: "Metabolizm" },
            { name: "Kremowy Oddech Awokado", ingredients: "Awokado (zdrowe t≈Çuszcze), Jarmu≈º, Brzoskwinia (mro≈ºona), Woda.", focus: "Zdrowe T≈Çuszcze" },
            { name: "Rzodkiewka i Kefir (Probiotyk)", ingredients: "Kefir Naturalny, Kilka Listk√≥w Rzodkiewki, Og√≥rek, Szpinak.", focus: "Probiotyki" },
            { name: "Marchewkowo-Selerowy Cleanser", ingredients: "Marchew (sok), Seler Naciowy, Jab≈Çko, Szczypta Pieprzu Cayenne.", focus: "Oczyszczanie" },
            { name: "Kompletny Aminokwasowy", ingredients: "Mleko Owiane, Od≈ºywka Konopna/Grochowa, Zielone Warzywa, Syrop Klonowy.", focus: "Bia≈Çko" },
            { name: "Szparagi i Gruszka (Moczopƒôdny)", ingredients: "3-4 gotowane Szparagi, Gruszka, Szpinak, Woda.", focus: "Detoks Wody" },
            { name: "Koktajl z P≈Çatkami Jƒôczmiennymi", ingredients: "P≈Çatki Jƒôczmienne, Mleko Ry≈ºowe, Jab≈Çko, Migda≈Çy.", focus: "B≈Çonnik" },
            { name: "Ananas i Li≈õcie Miƒôty", ingredients: "Ananas (bromelaina), Li≈õcie Miƒôty, Woda Kokosowa.", focus: "Trawienie" },
            { name: "Czerwony Detoks (Maliny i Czerwona Kapusta)", ingredients: "Maliny, 1/4 Czerwonej Kapusty, Jab≈Çko, Woda.", focus: "Antyoksydanty" },
            { name: "Zielony Energetyk z Bananem", ingredients: "Du≈ºy Banan, Mro≈ºony Jarmu≈º, Mleko Migda≈Çowe, Od≈ºywka Bia≈Çkowa.", focus: "Energia" },
            { name: "Wyb√≥r Tygodnia (Dzie≈Ñ Wolny)", ingredients: "Wybierz dowolny ulubiony koktajl z kwarta≈Çu 2.", focus: "Regeneracja" },
        ]; // 14 unikalnych

        // Kwarta≈Ç 3: LATO (Maj - Lipiec) - Cel: Nawodnienie
        const LATO = [
            { name: "Arbuzowy Elektrolit (Likopen)", ingredients: "Du≈ºo Arbuza, Woda Kokosowa, ≈öwie≈ºa Miƒôta, Sok z Limonki.", focus: "Nawodnienie" },
            { name: "Og√≥rkowo-Pomidorowy Ch≈Ç√≥d", ingredients: "Pomidor (likopen), Og√≥rek, Szpinak, Odrobina Bazylii, L√≥d.", focus: "Nawodnienie" },
            { name: "Truskawkowa Moc Antyoksydacyjna", ingredients: "≈öwie≈ºe Truskawki, Maliny, Jogurt Grecki, Woda.", focus: "Antyoksydanty" },
            { name: "Melon z Imbirem (Trawienie)", ingredients: "Melon Galia lub Kantalupa, Imbir, Kefir.", focus: "Trawienie" },
            { name: "Letnia Witamina C (Czarna Porzeczka)", ingredients: "Czarna Porzeczka (≈õwie≈ºa/mro≈ºona), Banan, Li≈õcie Jarmu≈ºu, Woda.", focus: "Odporno≈õƒá" },
            { name: "Koktajl z Papai (Enzymy)", ingredients: "Papaja (enzymy trawienne), Ananas, Miƒôta, Woda.", focus: "Enzymy" },
            { name: "Kremowy Kokosowy Raj", ingredients: "Mleko Kokosowe (t≈Çuszcze MCT), 1/2 Banana, Mango (mro≈ºone), L√≥d.", focus: "Energia" },
            { name: "Kiwi i Winogrona (Ochrona DNA)", ingredients: "Kiwi, Zielone Winogrona, Li≈õcie Szpinaku, Woda.", focus: "Antyoksydanty" },
            { name: "Morelowy Beta-Karoten", ingredients: "≈öwie≈ºe Morele, Marchewka, Sok Pomara≈Ñczowy, 1/2 Banana.", focus: "Sk√≥ra" },
            { name: "Cukinia i Bazylia (Lekkostrawny)", ingredients: "Cukinia (ugotowana lub surowa), Bazylia, Jogurt Naturalny, 1/2 Brzoskwini.", focus: "Lekkostrawny" },
            { name: "Og√≥rkowo-Koperkowy Ch≈Çodnik", ingredients: "Og√≥rek, Koperek, Kefir/Jogurt, 1/2 Jab≈Çka.", focus: "Ch≈Çodzenie" },
            { name: "Brzoskwiniowy Probiotyk", ingredients: "Brzoskwinia, Jogurt naturalny, Nasiona Chia, Woda.", focus: "Jelita" },
            { name: "Moc Witamin z Kalarepy", ingredients: "Kalarepa, Zielone Jab≈Çko, Szpinak, Sok z Limonki.", focus: "Witaminy" },
            { name: "Wyb√≥r Tygodnia (Dzie≈Ñ Wolny)", ingredients: "Wybierz dowolny ulubiony koktajl z kwarta≈Çu 3.", focus: "Regeneracja" },
        ]; // 14 unikalnych

        // Kwarta≈Ç 4: JESIE≈É (Sierpie≈Ñ - Pa≈∫dziernik) - Cel: Stabilizacja
        const JESIEN = [
            { name: "Pumpkin Spice Protein", ingredients: "Puree z Dyni (ugotowanej), Cynamon, Ga≈Çka Muszkato≈Çowa, Mleko, Od≈ºywka Bia≈Çkowa.", focus: "Bia≈Çko/W≈Ç√≥kno" },
            { name: "Jab≈Çkowo-Gruszkowa Witalno≈õƒá", ingredients: "Jab≈Çko, Gruszka, P≈Çatki Owsiane, Jogurt Naturalny, Imbir.", focus: "B≈Çonnik" },
            { name: "Orzechowa Moc z Datami", ingredients: "Daktyle, Mas≈Ço Orzechowe, Szpinak, Mleko, Cynamon.", focus: "Energia" },
            { name: "≈ªurawina na Uk≈Çad Moczowy", ingredients: "≈ªurawina (≈õwie≈ºa/mro≈ºona), Banan, Sok z Pomara≈Ñczy, Woda.", focus: "Zdrowie Moczowe" },
            { name: "Batat Kremowy (Wƒôglowodany)", ingredients: "Ugotowany Batat, Mleko, Cynamon, Ekstrakt Waniliowy.", focus: "Wƒôglowodany" },
            { name: "Czekolada i Orzechy W≈Çoskie (M√≥zg)", ingredients: "Kakao Naturalne, Orzechy W≈Çoskie, Banan, Mleko Migda≈Çowe.", focus: "Omega-3" },
            { name: "Ostatni Jarmu≈º Sezonu", ingredients: "Jarmu≈º, Winogrona, Awokado, Siemiƒô Lniane.", focus: "Detoks" },
            { name: "Seler Naciowy i Gorzkie Grejpfruty", ingredients: "Seler Naciowy, Grejpfrut, Woda, 1/2 Jab≈Çka.", focus: "Trawienie" },
            { name: "Granat i Kokos (Antyoksydanty)", ingredients: "Pestki Granatu, Mleko Kokosowe, 1/2 Banana.", focus: "Antyoksydanty" },
            { name: "Koktajl z P≈Çatkami Owsianymi (Syto≈õƒá)", ingredients: "P≈Çatki Owsiane, Woda, Mas≈Ço Orzechowe, 1/2 Banana, Od≈ºywka Bia≈Çkowa.", focus: "Syto≈õƒá" },
            { name: "Korze≈Ñ Pietruszki i Jab≈Çko", ingredients: "Ugotowany Korze≈Ñ Pietruszki, Jab≈Çko, Sok z Cytryny, Imbir.", focus: "Wzmocnienie" },
            { name: "Kremowy Ser Twarogowy i ≈öliwka", ingredients: "Ser Twarogowy (bia≈Çko), ≈öliwki (mro≈ºone), Mleko, Cynamon.", focus: "Bia≈Çko" },
            { name: "Nasiona S≈Çonecznika i P≈Çatki", ingredients: "Nasiona S≈Çonecznika (namoczone), P≈Çatki Owsiane, 1/2 Gruszki, Mleko.", focus: "T≈Çuszcze" },
            { name: "Wyb√≥r Tygodnia (Dzie≈Ñ Wolny)", ingredients: "Wybierz dowolny ulubiony koktajl z kwarta≈Çu 4.", focus: "Regeneracja" },
        ]; // 14 unikalnych

        const QUARTERS = [
            { id: 'ZIMA', name: 'ZIMA (Listopad - Stycze≈Ñ)', days: 91, recipes: ZIMA, color: 'bg-indigo-600', border: 'border-indigo-600', challenge: 'Cel: Wzmocnienie Odporno≈õci (Min. 80% koktajli z Imbirem/KurkumƒÖ/Wit. C)' },
            { id: 'WIOSNA', name: 'WIOSNA (Luty - Kwiecie≈Ñ)', days: 91, recipes: WIOSNA, color: 'bg-lime-600', border: 'border-lime-600', challenge: 'Cel: Wiosenne Oczyszczanie (Min. 70% dni Zielony Detoks)' },
            { id: 'LATO', name: 'LATO (Maj - Lipiec)', days: 91, recipes: LATO, color: 'bg-sky-500', border: 'border-sky-500', challenge: 'Cel: Nawodnienie i Energia (Codziennie sprawdzaj kolor moczu!)' },
            { id: 'JESIEN', name: 'JESIEN (Sierpie≈Ñ - Pa≈∫dziernik)', days: 92, recipes: JESIEN, color: 'bg-amber-600', border: 'border-amber-600', challenge: 'Cel: Stabilizacja i Magazynowanie (Skup siƒô na zdrowych t≈Çuszczach i b≈Çonniku)' },
        ];
        
        // Tablica wszystkich klas ramki, aby je p√≥≈∫niej usunƒÖƒá
        const ALL_BORDER_CLASSES = QUARTERS.map(q => q.border);


        // --- Generowanie Ca≈Çego Planu (365 Dni) ---
        const SHAKE_PLAN = [];
        let dayCounter = 1;

        QUARTERS.forEach(quarter => {
            for (let i = 0; i < quarter.days; i++) {
                const cycleIndex = i % quarter.recipes.length;
                const recipe = quarter.recipes[cycleIndex];
                SHAKE_PLAN.push({
                    day: dayCounter,
                    quarter: quarter.id,
                    quarterName: quarter.name,
                    recipeName: recipe.name,
                    ingredients: recipe.ingredients,
                    focus: recipe.focus,
                    cycleDay: cycleIndex + 1,
                    cardBorder: quarter.border,
                    cardColorClass: quarter.color, // Zachowaj klasƒô koloru
                });
                dayCounter++;
            }
        });

        // --- ZarzƒÖdzanie Stanem Lokalnym ---
        const COMPLETION_KEY = 'shake365_completed_days_v2'; // U≈ºycie nowej wersji klucza
        let completedDays = {}; 
        let currentFilterId = 'ALL'; // 'ALL' lub 'ZIMA', 'WIOSNA', 'LATO', 'JESIEN'

        function loadProgress() {
            const storedProgress = localStorage.getItem(COMPLETION_KEY);
            if (storedProgress) {
                try {
                    completedDays = JSON.parse(storedProgress);
                } catch (e) {
                    console.error("B≈ÇƒÖd parsowania localStorage:", e);
                    completedDays = {};
                }
            }
        }

        function saveProgress() {
            localStorage.setItem(COMPLETION_KEY, JSON.stringify(completedDays));
        }

        // --- Funkcje Daty i Dnia Roku ---
        
        function getDayOfYear(date) {
            const start = new Date(date.getFullYear(), 0, 0);
            const diff = (date - start) + ((start.getTimezoneOffset() - date.getTimezoneOffset()) * 60 * 1000);
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        }

        function getTodayShakeDay() {
            // Zwraca numer dnia w roku, kt√≥ry odpowiada pozycji w tablicy SHAKE_PLAN (1-365)
            return getDayOfYear(new Date());
        }

        function getQuarterFromDay(dayNumber) {
            if (dayNumber >= 1 && dayNumber <= 91) return 'ZIMA';
            if (dayNumber >= 92 && dayNumber <= 182) return 'WIOSNA';
            if (dayNumber >= 183 && dayNumber <= 273) return 'LATO';
            return 'JESIEN';
        }
        
        // --- Funkcje UI i Logika ---

        window.setCurrentFilter = (filterId) => {
            currentFilterId = filterId;
            renderPlan(false); // Nie przewijaj przy zmianie filtra
        }

        window.toggleCompletion = function(day, event) {
            event.stopPropagation();

            const dayKey = String(day);

            if (completedDays[dayKey]) {
                delete completedDays[dayKey];
            } else {
                completedDays[dayKey] = true;
            }

            saveProgress();
            renderPlan(false); // Nie przewijaj przy klikniƒôciu
        }
        
        // --- Modal Funkcje (Bez alert/confirm) ---

        const modal = document.getElementById('custom-modal');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');

        window.closeModal = function() {
            modal.classList.add('hidden');
            modalConfirmBtn.onclick = null; 
        }

        window.confirmReset = function() {
            document.getElementById('modal-title').textContent = "Potwierd≈∫ Reset";
            document.getElementById('modal-message').textContent = "Czy na pewno chcesz zresetowaƒá postƒôpy wszystkich 365 dni? Dane ZOSTANƒÑ trwale usuniƒôte z Twojej przeglƒÖdarki.";
            
            modalConfirmBtn.textContent = "Resetuj";
            modalConfirmBtn.className = 'px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors';
            
            modalConfirmBtn.onclick = function() {
                resetProgress();
                closeModal();
            };

            modal.classList.remove('hidden');
        }

        function resetProgress() {
            completedDays = {};
            saveProgress();
            renderPlan(true); // Od≈õwie≈º i przewi≈Ñ na dzisiaj po resecie
        }
        
        function updateProgressDisplay() {
            const totalDays = SHAKE_PLAN.length;
            const completedCount = Object.keys(completedDays).length;
            const percentage = totalDays > 0 ? ((completedCount / totalDays) * 100).toFixed(1) : 0;
            
            const progressEl = document.getElementById('progress-display');
            progressEl.innerHTML = `Uko≈Ñczone: <span class="text-white font-bold">${completedCount}</span> z ${totalDays} dni | Postƒôp Og√≥lny: <span class="text-white font-bold">${percentage}%</span>`;
        }
        
        function updateQuarterChallenge() {
            const quarterId = currentFilterId !== 'ALL' ? currentFilterId : getQuarterFromDay(getTodayShakeDay());
            const quarterData = QUARTERS.find(q => q.id === quarterId);
            
            if (!quarterData) return;
            
            const totalQuarterDays = quarterData.days;
            
            // Liczenie uko≈Ñczonych dni w danym kwartale
            const completedInQuarter = SHAKE_PLAN.filter(item => 
                item.quarter === quarterId && completedDays[String(item.day)]
            ).length;
            
            const quarterPercentage = (completedInQuarter / totalQuarterDays) * 100;
            const percentageText = quarterPercentage.toFixed(1) + '%';
            
            const isCompleted = quarterPercentage >= 100;

            const challengeHtml = `
                <p class="text-xs font-semibold uppercase text-gray-500 mb-2">Aktualne Wyzwanie: ${quarterData.name}</p>
                <h3 class="text-lg font-bold text-gray-800 mb-3">${quarterData.challenge}</h3>
                
                <div class="flex justify-between items-center text-sm font-medium mb-1">
                    <span class="${isCompleted ? 'text-green-600 font-bold' : 'text-gray-700'}">${isCompleted ? '‚≠ê CEL OSIƒÑGNIƒòTY!' : 'Postƒôp Kwarta≈Çu: ' + percentageText}</span>
                    <span class="text-gray-500">${completedInQuarter}/${totalQuarterDays} dni</span>
                </div>

                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div class="${isCompleted ? 'bg-green-600' : quarterData.color} h-3 rounded-full transition-all duration-700 ease-out" style="width: ${percentageText}"></div>
                </div>
            `;
            
            document.getElementById('challenge-display').innerHTML = challengeHtml;
            
            // NAPRAWIONY B≈ÅƒÑD: U≈ºycie operatora spread do poprawnego usuniƒôcia wielu klas
            document.getElementById('challenge-display').classList.remove(...ALL_BORDER_CLASSES);
            document.getElementById('challenge-display').classList.add(quarterData.border);
        }

        // G≈Ç√≥wna funkcja renderujƒÖca plan
        function renderPlan(scrollToToday = false) {
            const listElement = document.getElementById('shake-list');
            const quarterButtonsContainer = document.getElementById('quarter-buttons');
            const todayShakeDay = getTodayShakeDay();
            listElement.innerHTML = '';
            quarterButtonsContainer.innerHTML = '';
            
            // 1. Zaktualizuj stan filtra
            const filterStatusEl = document.getElementById('filter-status');
            if (currentFilterId === 'ALL') {
                filterStatusEl.textContent = `Poka≈º wszystkie ${SHAKE_PLAN.length} dni.`;
            } else {
                const quarterName = QUARTERS.find(q => q.id === currentFilterId).name;
                filterStatusEl.textContent = `Filtrowanie: ${quarterName}`;
            }

            // 2. Renderowanie przycisk√≥w kwarta≈Ç√≥w + przycisk "Wszystkie"
            
            // Przycisk "Wszystkie"
            const allButton = document.createElement('button');
            allButton.textContent = 'Wszystkie';
            allButton.className = `flex-1 p-3 rounded-xl text-sm font-bold transition duration-200 shadow-md transform hover:scale-[1.03] ${
                currentFilterId === 'ALL' ? 'bg-emerald-600 text-white ring-2 ring-offset-2 ring-emerald-500 ring-opacity-50' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
            }`;
            allButton.onclick = () => setCurrentFilter('ALL');
            quarterButtonsContainer.appendChild(allButton);
            
            // Przyciski kwarta≈Ç√≥w
            QUARTERS.forEach(q => {
                const isActive = q.id === currentFilterId;
                const button = document.createElement('button');
                button.textContent = q.name.split(' ')[0];
                button.className = `flex-1 p-3 rounded-xl text-sm font-bold transition duration-200 shadow-md transform hover:scale-[1.03] ${
                    isActive ? `${q.color} text-white ring-2 ring-offset-2 ring-emerald-500 ring-opacity-50` : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`;
                button.onclick = () => setCurrentFilter(q.id);
                quarterButtonsContainer.appendChild(button);
            });
            
            updateProgressDisplay();
            updateQuarterChallenge();


            // 3. Filtrowanie i renderowanie koktajli
            let filteredPlan = SHAKE_PLAN;
            if (currentFilterId !== 'ALL') {
                filteredPlan = SHAKE_PLAN.filter(item => item.quarter === currentFilterId);
            }
            
            let elementToScrollTo = null;

            filteredPlan.forEach(item => {
                const isCompleted = !!completedDays[String(item.day)];
                const isToday = item.day === todayShakeDay;
                
                const card = document.createElement('div');
                card.id = `day-card-${item.day}`;
                
                // Ustawienie klas dla karty
                let cardClasses = `shake-card bg-white rounded-xl overflow-hidden transition-all duration-300 mb-4 shadow-md cursor-pointer border-l-4 border-opacity-0 hover:shadow-xl`;
                
                // Klasy dla dzisiejszego dnia
                if (isToday) {
                    cardClasses = `${cardClasses} today border-l-0 ${item.cardBorder}`;
                } else if (isCompleted) {
                     // Uko≈Ñczone dni
                    cardClasses = `${cardClasses} completed border-l-4 border-opacity-70 ${item.cardBorder.replace('border-', 'border-l-')}`;
                } else {
                    // Normalne dni, dodaj klasƒô do hovera
                    cardClasses = `${cardClasses} hover:border-l-4 hover:border-opacity-100 ${item.cardBorder.replace('border-', 'hover:border-')}`;
                }

                // Domy≈õlnie otw√≥rz dzisiejszy koktajl
                const isInitiallyOpen = isToday || (isCompleted && currentFilterId !== 'ALL');
                if (isInitiallyOpen) {
                    cardClasses += ' open';
                    elementToScrollTo = card;
                }
                
                card.className = cardClasses;

                card.innerHTML = `
                    <div class="day-header flex justify-between items-center p-4">
                        <!-- G≈Ç√≥wna zawarto≈õƒá -->
                        <div class="flex-1 min-w-0 pr-4" onclick="this.closest('.shake-card').classList.toggle('open')">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="text-xs font-mono text-gray-500 leading-none">${item.quarterName.split('(')[0].trim()} | Dzie≈Ñ ${item.day}</span>
                                ${isToday ? '<span class="px-2 py-0.5 text-xs font-bold rounded-full bg-emerald-500 text-white shadow-md">DZI≈ö</span>' : ''}
                                <span class="px-2 py-0.5 text-xs font-semibold rounded-full text-white ${item.cardColorClass}">${item.focus}</span>
                            </div>
                            <h2 class="text-lg font-extrabold text-gray-800 leading-tight">${item.recipeName}</h2>
                        </div>
                        
                        <!-- Checkbox -->
                        <div class="flex-shrink-0">
                             <label class="checkbox-container">
                                <input type="checkbox" ${isCompleted ? 'checked' : ''} onclick="window.toggleCompletion(${item.day}, event)">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Szczeg√≥≈Çy - domy≈õlnie ukryte -->
                    <div class="shake-details border-t border-gray-100">
                        <p class="text-sm text-gray-600">
                            <strong class="font-semibold text-gray-700">Sk≈Çadniki:</strong> ${item.ingredients}
                        </p>
                    </div>
                `;

                listElement.appendChild(card);
            });
            
            // 4. Przewijanie do aktualnego dnia
            if (scrollToToday && elementToScrollTo) {
                 // U≈ºyj timeout, aby daƒá czas na wyrenderowanie listy w DOM
                setTimeout(() => {
                    elementToScrollTo.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        }

        // --- Inicjalizacja Aplikacji ---
        window.onload = function() {
            loadProgress();
            
            // Ustawienie poczƒÖtkowego kwarta≈Çu na podstawie dzisiejszego dnia
            const todayShakeDay = getTodayShakeDay();
            const initialQuarter = getQuarterFromDay(todayShakeDay);
            currentFilterId = initialQuarter; // Ustaw domy≈õlny filtr na kwarta≈Ç dzisiejszego dnia
            
            // Uruchom renderowanie i przewi≈Ñ do dzisiaj
            renderPlan(true); 
        };

    </script>
</body>
</html>