<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>365 Dni Koktajli Sezonowych - Tracker</title>
    <!-- ≈Åadowanie Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Definicje niestandardowych kolor√≥w i styl√≥w dla estetyki */
        :root {
            --color-primary: #059669; /* Emerald Green */
            --color-secondary: #064E3B; /* Darker Emerald */
            --color-text: #1F2937;
            --color-bg-light: #F9FAFB;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-light);
            color: var(--color-text);
        }

        /* Utrzymanie nag≈Ç√≥wka na g√≥rze */
        .sticky-header {
            top: 0;
            z-index: 20;
        }

        /* --- Custom Checkbox (Stylizacja dla lepszej interakcji dotykowej) --- */
        .checkbox-container {
            display: block;
            position: relative;
            cursor: pointer;
            width: 28px;
            height: 28px;
        }

        .checkbox-container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        /* Stylizacja kwadratowego znacznika */
        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 28px;
            width: 28px;
            border-radius: 8px; 
            background-color: #E5E7EB; 
            transition: all 0.2s;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 2px solid #D1D5DB;
        }

        .checkbox-container:hover input ~ .checkmark {
            background-color: #D1FAE5; 
        }

        /* Kolor, gdy checkbox jest zaznaczony (zmieni siƒô dynamicznie przez JS/Tailwind) */
        .checkbox-container input:checked ~ .checkmark {
            background-color: var(--color-primary);
            border-color: var(--color-primary);
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
        }

        /* Stylizacja znacznika 'ptaszka' */
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        /* Poka≈º znacznik po zaznaczeniu */
        .checkbox-container input:checked ~ .checkmark:after {
            display: block;
        }

        /* Stylizacja samego 'ptaszka' (bia≈Çy) */
        .checkbox-container .checkmark:after {
            left: 9px;
            top: 5px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }

        /* Karta po uko≈Ñczeniu */
        .shake-card.completed {
            background-color: #F0FFF4; 
            opacity: 0.85;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        /* Styl szczeg√≥≈Ç√≥w (ukryte domy≈õlnie) */
        .shake-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
            padding: 0 1rem;
        }
        
        /* Styl szczeg√≥≈Ç√≥w po otwarciu */
        .shake-card.open .shake-details {
            max-height: 500px; /* Zwiƒôkszone, aby pomie≈õciƒá wiƒôcej tre≈õci */
            padding-bottom: 1rem;
            padding-top: 0.5rem;
        }
        
        .shake-card.today {
            /* Dodatkowy styl dla dzisiejszego dnia */
            border: 4px solid;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            animation: pulse-border 1.5s infinite alternate;
        }

        /* Animacja delikatnego pulsowania ramki dla dzisiejszego dnia */
        @keyframes pulse-border {
            0% { border-color: rgba(5, 150, 105, 0.4); }
            100% { border-color: rgba(5, 150, 105, 1); }
        }
    </style>
</head>
<body class="selection:bg-green-200">

    <div id="app" class="max-w-xl mx-auto min-h-screen">

        <!-- Nag≈Ç√≥wek i Status -->
        <header class="bg-gradient-to-r from-emerald-500 to-teal-500 text-white p-6 shadow-2xl rounded-b-3xl mb-6 sticky-header">
            <a href="index.html" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white/90 hover:text-white transition duration-200 text-sm font-semibold p-2 rounded-lg">
                ‚Üê Home
            </a>
            <h1 class="text-3xl font-extrabold text-center mb-1 drop-shadow-md">üåø 365 Dni Zielonej Mocy</h1>
            <p class="text-sm text-center opacity-90 mb-4">Wyzwanie Sezonowe: Uko≈Ñcz 100% kwarta≈Çu!</p>
            <div id="progress-display" class="text-center font-semibold bg-white/20 backdrop-blur-sm rounded-full py-1 text-sm shadow-inner transition duration-500">
                ≈Åadowanie postƒôpu...
            </div>
        </header>

        <!-- Wyzwanie Sezonowe -->
        <div id="challenge-display" class="bg-white mx-4 p-4 rounded-xl shadow-lg border-t-4 border-emerald-500 mb-6 transition-all duration-300">
             <!-- Tre≈õƒá zostanie za≈Çadowana dynamicznie -->
        </div>
        
        <!-- Przycisk Resetowania Danych -->
        <div class="px-4 mb-4">
            <button onclick="confirmReset()" class="w-full bg-red-100 text-red-700 hover:bg-red-200 transition-colors duration-200 p-2 text-sm font-medium rounded-lg shadow-sm">
                Resetuj wszystkie postƒôpy
            </button>
        </div>


        <!-- Przyciski Kwarta≈Ç√≥w (Tabs) -->
        <div id="quarter-buttons" class="flex justify-between space-x-2 px-4 mb-6">
            <!-- Przyciski zostanƒÖ wygenerowane dynamicznie przez JS -->
        </div>
        
        <p id="filter-status" class="text-center text-sm font-medium text-gray-500 mb-4 transition-opacity duration-300">
            Poka≈º wszystkie 365 dni.
        </p>

        <!-- Kontener dla listy Koktajli -->
        <div class="px-4 pb-12" id="shake-list">
            <!-- Lista koktajli zostanie wygenerowana dynamicznie przez JS -->
        </div>

    </div>

    <!-- Niestandardowy Modal (Zastƒôpuje alert/confirm) -->
    <div id="custom-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" onclick="closeModal()">
        <div class="bg-white rounded-xl p-6 shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-95" onclick="event.stopPropagation()">
            <h3 id="modal-title" class="text-xl font-bold mb-3 text-gray-800">Potwierd≈∫ Akcjƒô</h3>
            <p id="modal-message" class="text-gray-600 mb-6">Czy na pewno chcesz zresetowaƒá wszystkie postƒôpy? Ta akcja jest nieodwracalna.</p>
            <div class="flex justify-end space-x-3">
                <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition-colors">Anuluj</button>
                <button id="modal-confirm-btn" class="px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors">Potwierd≈∫</button>
            </div>
        </div>
    </div>

    <script>
        // --- Dane Planu Koktajlowego (365 Dni, 4 Kwarta≈Çy) ---

        // Kwarta≈Ç 1: ZIMA (Listopad - Stycze≈Ñ) - Cel: Wzmocnienie
        const ZIMA = [
            { name: "Zimowy Wojownik (Imbir/Kurkuma)", ingredients: "Mro≈ºone Mango, Kurkuma, Imbir, Czarny Pieprz, Mleko Owiane.", focus: "Odporno≈õƒá", nutritionalBenefit: "Silny duet przeciwzapalny: **Kurkuma** (kurkumina) i **Imbir** wspierajƒÖ uk≈Çad odporno≈õciowy. **Czarny Pieprz** zwiƒôksza wch≈Çanianie kurkuminy o 2000%. Mango dostarcza witaminy A i C." },
            { name: "Cytrusowa Tarcza (Witamina C)", ingredients: "Pomara≈Ñcza, Mandarynka, 1/2 Banana, Siemiƒô Lniane, Woda.", focus: "Odporno≈õƒá", nutritionalBenefit: "Mega dawka **Witaminy C** z cytrus√≥w wzmacnia odporno≈õƒá i produkcjƒô kolagenu. **Siemiƒô Lniane** jest ≈∫r√≥d≈Çem kwas√≥w Omega-3 (ALA) i b≈Çonnika, wspierajƒÖcego jelita." },
            { name: "Zielone Paliwo (Antyoksydanty)", ingredients: "Mro≈ºony Jarmu≈º/Szpinak, Jab≈Çko, Cynamon, Nasiona Chia, Woda.", focus: "Wzmocnienie", nutritionalBenefit: "Zielenina jest bogata w **witaminƒô K** i **≈ºelazo**. **Nasiona Chia** to hydrofilowy b≈Çonnik, kt√≥ry pƒôcznieje w ≈ºo≈ÇƒÖdku, dajƒÖc uczucie syto≈õci i regulujƒÖc poziom cukru." },
            { name: "RozgrzewajƒÖcy Owsiany", ingredients: "P≈Çatki Owsiane (namoczone), Mas≈Ço Orzechowe, Banan, Mleko, Szczypta Kakao.", focus: "Energia", nutritionalBenefit: "**P≈Çatki Owsiane** sƒÖ ≈∫r√≥d≈Çem beta-glukan√≥w, kt√≥re obni≈ºajƒÖ cholesterol i stabilizujƒÖ energiƒô. **Mas≈Ço Orzechowe** dostarcza zdrowych t≈Çuszcz√≥w i bia≈Çka, idealnych na d≈Çugotrwa≈ÇƒÖ syto≈õƒá." },
            { name: "Czerwona Si≈Ça Buraka", ingredients: "Ugotowany Burak, Jab≈Çko, Mro≈ºone Wi≈õnie, Imbir, Sok z Cytryny.", focus: "Detoks", nutritionalBenefit: "**Buraki** zawierajƒÖ azotany, kt√≥re sƒÖ przekszta≈Çcane w tlenek azotu ‚Äì poprawiajƒÖ przep≈Çyw krwi i wydolno≈õƒá. **Wi≈õnie** (melatonina) wspierajƒÖ jako≈õƒá snu i regeneracjƒô." },
            { name: "Bomba Bia≈Çkowa z Nasion", ingredients: "Szpinak, Mleko Migda≈Çowe, Od≈ºywka Bia≈Çkowa (lub Tofu), Pestki Dyni, 1/2 Gruszki.", focus: "Bia≈Çko", nutritionalBenefit: "Zapewnia kompletny profil aminokwasowy. **Pestki Dyni** to doskona≈Çe ≈∫r√≥d≈Ço **Cynku** i Magnezu, kluczowych dla zdrowia hormonalnego i odporno≈õci." },
            { name: "Jagodowy Power (Mro≈ºone)", ingredients: "Mieszanka Mro≈ºonych Jag√≥d, Jogurt Naturalny, Mi√≥d, Woda.", focus: "Antyoksydanty", nutritionalBenefit: "**Jagody** sƒÖ jednymi z najbogatszych ≈∫r√≥de≈Ç **antocyjan√≥w**, kt√≥re chroniƒÖ m√≥zg przed stresem oksydacyjnym i poprawiajƒÖ wzrok. **Jogurt** dostarcza probiotyk√≥w." },
            { name: "Kawa na Czyste My≈õlenie", ingredients: "Kawa Parzona na Zimno, Mleko Kokosowe, Cynamon, 1 ≈Åy≈ºeczka Oleju MCT.", focus: "Focus", nutritionalBenefit: "**Kofeina** i **Olej MCT** (≈õrednio≈Ça≈Ñcuchowe kwasy t≈Çuszczowe) dostarczajƒÖ szybkiej energii dla m√≥zgu bez skoku cukru. Idealne na poranny mentalny zastrzyk." },
            { name: "Miodowo-Czosnkowy (Naturalny Antybiotyk)", ingredients: "Banan, Mi√≥d, Woda, 1/4 ZƒÖbka Czosnku (opcjonalnie!), Pomara≈Ñcza.", focus: "Odporno≈õƒá", nutritionalBenefit: "**Czosnek** (allicyna) jest silnym naturalnym antybiotykiem i ≈õrodkiem przeciwwirusowym. **Mi√≥d** dzia≈Ça ≈ÇagodzƒÖco. Koktajl ma silny wp≈Çyw na wzmocnienie w sezonie przeziƒôbie≈Ñ." },
            { name: "Koktajl z P≈Çatkami ≈ªytnimi", ingredients: "P≈Çatki ≈ªytnie, Siemiƒô Lniane, Mleko Ry≈ºowe, Jab≈Çko, Cynamon.", focus: "B≈Çonnik", nutritionalBenefit: "**P≈Çatki ≈ªytnie** sƒÖ bogate w b≈Çonnik nierozpuszczalny, kt√≥ry doskonale reguluje pracƒô jelit i przeciwdzia≈Ça zaparciom. Niski Indeks Glikemiczny zapewnia stabilno≈õƒá cukru." },
            { name: "Kremowy Banan i Kakao", ingredients: "Banan, Kakao Naturalne, Mleko Owiane, 1 ≈Åy≈ºeczka Mas≈Ça Migda≈Çowego.", focus: "Uspokojenie", nutritionalBenefit: "**Kakao** jest bogate w magnez i tryptofan (prekursor serotoniny), kt√≥re wspierajƒÖ relaksacjƒô i poprawiajƒÖ nastr√≥j. **Banan** dostarcza potasu, wa≈ºnego dla miƒô≈õni i ci≈õnienia." },
            { name: "Koktajl z KiszonƒÖ KapustƒÖ (Probiotyki)", ingredients: "Ma≈Ça ilo≈õƒá soku z Kiszonej Kapusty, Og√≥rek, Jab≈Çko, Szpinak, Woda.", focus: "Jelita", nutritionalBenefit: "**Sok z Kiszonej Kapusty** jest potƒô≈ºnym ≈∫r√≥d≈Çem **naturalnych probiotyk√≥w** (bakterii kwasu mlekowego), kt√≥re sƒÖ kluczowe dla mikrobiomu i zdrowia jelit." },
            { name: "Mro≈ºona Gruszka i Kardamon", ingredients: "Mro≈ºona Gruszka, Kardamon, Mleko Migda≈Çowe, 1/2 Banana.", focus: "Rozgrzewanie", nutritionalBenefit: "**Kardamon** ma w≈Ça≈õciwo≈õci termogeniczne (rozgrzewajƒÖce) i wspomaga trawienie. **Gruszka** dostarcza naturalnych cukr√≥w i du≈ºej ilo≈õci b≈Çonnika." },
            { name: "Wyb√≥r Tygodnia (Dzie≈Ñ Wolny)", ingredients: "Wybierz dowolny ulubiony koktajl z kwarta≈Çu 1.", focus: "Regeneracja", nutritionalBenefit: "Dzie≈Ñ swobodnego wyboru pozwala s≈Çuchaƒá potrzeb organizmu. Wybierz sk≈Çadniki, kt√≥re sƒÖ dla Ciebie dzi≈õ najwa≈ºniejsze: bia≈Çko, b≈Çonnik czy witaminy." },
        ]; // 14 unikalnych

        // Kwarta≈Ç 2: WIOSNA (Luty - Kwiecie≈Ñ) - Cel: Oczyszczanie
        const WIOSNA = [
            { name: "Zielony Detoks (Chlorofil)", ingredients: "≈öwie≈ºy Og√≥rek, M≈Çody Szpinak, Kiwi, Sok z Limonki, Woda Kokosowa.", focus: "Detoks", nutritionalBenefit: "**Chlorofil** z zielonych li≈õci wspiera naturalne procesy detoksykacji i oczyszcza krew. **Kiwi** dostarcza enzym√≥w (aktynidyna) wspomagajƒÖcych trawienie bia≈Çek." },
            { name: "Wiosenna Odnowa z PokrzywƒÖ", ingredients: "≈öwie≈ºa lub Mro≈ºona Pokrzywa, Jab≈Çko, Banan, Siemiƒô Lniane.", focus: "Oczyszczanie", nutritionalBenefit: "**Pokrzywa** jest tradycyjnie u≈ºywana jako ≈õrodek moczopƒôdny, wspomagajƒÖcy usuwanie nadmiaru wody i toksyn z organizmu. Jest te≈º bogata w ≈ºelazo." },
            { name: "B≈Çonnikowa Moc Chia i Kie≈Çk√≥w", ingredients: "Mleko Migda≈Çowe, Banan, Nasiona Chia, ≈Åy≈ºka Kie≈Çk√≥w Broku≈Ça.", focus: "B≈Çonnik", nutritionalBenefit: "**Kie≈Çki Broku≈Ça** sƒÖ koncentracjƒÖ **sulforafanu**, zwiƒÖzku o silnych w≈Ça≈õciwo≈õciach antynowotworowych i detoksykujƒÖcych. B≈Çonnik z Chia poprawia perystaltykƒô." },
            { name: "Grejpfrutowy Spalacz T≈Çuszczu", ingredients: "Grejpfrut, Pomara≈Ñcza, Odrobina Imbiru, Li≈õcie Miƒôty.", focus: "Metabolizm", nutritionalBenefit: "**Grejpfrut** zawiera **naringeninƒô**, kt√≥ra mo≈ºe pom√≥c w regulacji poziomu insuliny i metabolizmie t≈Çuszcz√≥w. Imbir dodatkowo podkrƒôca termogenezƒô." },
            { name: "Kremowy Oddech Awokado", ingredients: "Awokado (zdrowe t≈Çuszcze), Jarmu≈º, Brzoskwinia (mro≈ºona), Woda.", focus: "Zdrowe T≈Çuszcze", nutritionalBenefit: "**Awokado** dostarcza kwas√≥w t≈Çuszczowych **jednonienasyconych** (zdrowie serca) i jest idealnym no≈õnikiem dla witamin rozpuszczalnych w t≈Çuszczach (A, E, K)." },
            { name: "Rzodkiewka i Kefir (Probiotyk)", ingredients: "Kefir Naturalny, Kilka Listk√≥w Rzodkiewki, Og√≥rek, Szpinak.", focus: "Probiotyki", nutritionalBenefit: "**Kefir** jest jednym z najlepszych ≈∫r√≥de≈Ç **probiotyk√≥w** i wapnia. **Rzodkiewka** wspiera wƒÖtrobƒô i woreczek ≈º√≥≈Çciowy, wspomagajƒÖc proces trawienia t≈Çuszcz√≥w." },
            { name: "Marchewkowo-Selerowy Cleanser", ingredients: "Marchew (sok), Seler Naciowy, Jab≈Çko, Szczypta Pieprzu Cayenne.", focus: "Oczyszczanie", nutritionalBenefit: "**Marchew** (beta-karoten, prekursor Wit. A) jest kluczowa dla zdrowej sk√≥ry i wzroku. **Seler Naciowy** jest silnie alkalizujƒÖcy i pomaga w r√≥wnowa≈ºeniu pH organizmu." },
            { name: "Kompletny Aminokwasowy", ingredients: "Mleko Owiane, Od≈ºywka Konopna/Grochowa, Zielone Warzywa, Syrop Klonowy.", focus: "Bia≈Çko", nutritionalBenefit: "Ro≈õlinne od≈ºywki bia≈Çkowe dostarczajƒÖ wszystkich **niezbƒôdnych aminokwas√≥w** (BCAA), kluczowych dla budowy i regeneracji miƒô≈õni, co jest wa≈ºne przy wiosennym wzro≈õcie aktywno≈õci." },
            { name: "Szparagi i Gruszka (Moczopƒôdny)", ingredients: "3-4 gotowane Szparagi, Gruszka, Szpinak, Woda.", focus: "Detoks Wody", nutritionalBenefit: "**Szparagi** sƒÖ naturalnym, ≈Çagodnym ≈õrodkiem moczopƒôdnym, kt√≥ry pomaga zredukowaƒá zatrzymywanie wody i wzdƒôcia. SƒÖ te≈º ≈∫r√≥d≈Çem kwasu foliowego." },
            { name: "Koktajl z P≈Çatkami Jƒôczmiennymi", ingredients: "P≈Çatki Jƒôczmienne, Mleko Ry≈ºowe, Jab≈Çko, Migda≈Çy.", focus: "B≈Çonnik", nutritionalBenefit: "**P≈Çatki Jƒôczmienne** zawierajƒÖ unikalne zwiƒÖzki beta-glukan√≥w, kt√≥re sƒÖ niezwykle skuteczne w obni≈ºaniu z≈Çego cholesterolu (LDL)." },
            { name: "Ananas i Li≈õcie Miƒôty", ingredients: "Ananas (bromelaina), Li≈õcie Miƒôty, Woda Kokosowa.", focus: "Trawienie", nutritionalBenefit: "**Ananas** jest bogaty w **bromelainƒô**, enzym u≈ÇatwiajƒÖcy trawienie bia≈Çek i zmniejszajƒÖcy stany zapalne w przewodzie pokarmowym. Woda kokosowa zapewnia elektrolity." },
            { name: "Czerwony Detoks (Maliny i Czerwona Kapusta)", ingredients: "Maliny, 1/4 Czerwonej Kapusty, Jab≈Çko, Woda.", focus: "Antyoksydanty", nutritionalBenefit: "**Czerwona Kapusta** dostarcza antocyjan√≥w i zwiƒÖzk√≥w siarki, kt√≥re wspierajƒÖ drugƒÖ fazƒô detoksykacji wƒÖtroby. **Maliny** sƒÖ bogate w b≈Çonnik i Witaminƒô C." },
            { name: "Zielony Energetyk z Bananem", ingredients: "Du≈ºy Banan, Mro≈ºony Jarmu≈º, Mleko Migda≈Çowe, Od≈ºywka Bia≈Çkowa.", focus: "Energia", nutritionalBenefit: "Idealny shake potreningowy. **Jarmu≈º** zapewnia minera≈Çy utracone z potem, a po≈ÇƒÖczenie bia≈Çka i wƒôglowodan√≥w (banan) regeneruje glikogen i miƒô≈õnie." },
            { name: "Wyb√≥r Tygodnia (Dzie≈Ñ Wolny)", ingredients: "Wybierz dowolny ulubiony koktajl z kwarta≈Çu 2.", focus: "Regeneracja", nutritionalBenefit: "Dzie≈Ñ swobodnego wyboru pozwala s≈Çuchaƒá potrzeb organizmu. Kontynuuj proces oczyszczania, wybierajƒÖc lekki i detoksykujƒÖcy koktajl z dominacjƒÖ warzyw." },
        ]; // 14 unikalnych

        // Kwarta≈Ç 3: LATO (Maj - Lipiec) - Cel: Nawodnienie
        const LATO = [
            { name: "Arbuzowy Elektrolit (Likopen)", ingredients: "Du≈ºo Arbuza, Woda Kokosowa, ≈öwie≈ºa Miƒôta, Sok z Limonki.", focus: "Nawodnienie", nutritionalBenefit: "**Arbuz** sk≈Çada siƒô w 92% z wody i jest bogaty w **cytrulinƒô** (poprawia krƒÖ≈ºenie) oraz **Likopen** (silny antyoksydant, zdrowie sk√≥ry). **Woda Kokosowa** dostarcza Potasu." },
            { name: "Og√≥rkowo-Pomidorowy Ch≈Ç√≥d", ingredients: "Pomidor (likopen), Og√≥rek, Szpinak, Odrobina Bazylii, L√≥d.", focus: "Nawodnienie", nutritionalBenefit: "**Pomidor** (Likopen) i **Og√≥rek** (woda, krzemionka) to idealne nawodnienie kom√≥rkowe. Likopen jest lepiej przyswajany z blendowanych warzyw." },
            { name: "Truskawkowa Moc Antyoksydacyjna", ingredients: "≈öwie≈ºe Truskawki, Maliny, Jogurt Grecki, Woda.", focus: "Antyoksydanty", nutritionalBenefit: "**Truskawki** i **Maliny** sƒÖ bardzo niskokaloryczne i bogate w Witaminƒô C oraz **kwas elagowy**, kt√≥ry chroni kom√≥rki przed uszkodzeniem. **Jogurt Grecki** to ≈∫r√≥d≈Ço bia≈Çka." },
            { name: "Melon z Imbirem (Trawienie)", ingredients: "Melon Galia lub Kantalupa, Imbir, Kefir.", focus: "Trawienie", nutritionalBenefit: "**Melon** jest lekki i ≈Çatwo przyswajalny. **Kefir** zapewnia ≈ºywe kultury bakterii. Imbir ≈Çagodzi ≈ºo≈ÇƒÖdek po ciƒô≈ºszych letnich posi≈Çkach." },
            { name: "Letnia Witamina C (Czarna Porzeczka)", ingredients: "Czarna Porzeczka (≈õwie≈ºa/mro≈ºona), Banan, Li≈õcie Jarmu≈ºu, Woda.", focus: "Odporno≈õƒá", nutritionalBenefit: "**Czarna Porzeczka** zawiera rekordowe ilo≈õci **Witaminy C** oraz antocyjan√≥w, kt√≥re sƒÖ kluczowe dla ochrony organizmu przed letnimi infekcjami i stresem." },
            { name: "Koktajl z Papai (Enzymy)", ingredients: "Papaja (enzymy trawienne), Ananas, Miƒôta, Woda.", focus: "Enzymy", nutritionalBenefit: "**Papaja** zawiera **papainƒô**, a **Ananas** ‚Äì **bromelainƒô**. Te dwa enzymy proteolityczne (trawiƒÖce bia≈Çka) sƒÖ idealne dla os√≥b z problemami trawiennymi i po ciƒô≈ºkim treningu." },
            { name: "Kremowy Kokosowy Raj", ingredients: "Mleko Kokosowe (t≈Çuszcze MCT), 1/2 Banana, Mango (mro≈ºone), L√≥d.", focus: "Energia", nutritionalBenefit: "Dostarcza **zdrowych t≈Çuszcz√≥w MCT** (≈õrednio≈Ça≈Ñcuchowe kwasy t≈Çuszczowe) z kokosa, kt√≥re sƒÖ natychmiastowym ≈∫r√≥d≈Çem energii. **Mango** zawiera Witaminƒô A (dla sk√≥ry)." },
            { name: "Kiwi i Winogrona (Ochrona DNA)", ingredients: "Kiwi, Zielone Winogrona, Li≈õcie Szpinaku, Woda.", focus: "Antyoksydanty", nutritionalBenefit: "**Winogrona** (resweratrol) i **Kiwi** to mocne antyoksydanty chroniƒÖce kom√≥rki. Kiwi dostarcza r√≥wnie≈º kwasu foliowego, wa≈ºnego dla podzia≈Çu kom√≥rkowego." },
            { name: "Morelowy Beta-Karoten", ingredients: "≈öwie≈ºe Morele, Marchewka, Sok Pomara≈Ñczowy, 1/2 Banana.", focus: "Sk√≥ra", nutritionalBenefit: "WyjƒÖtkowo bogaty w **Beta-Karoten**, kt√≥ry organizm przekszta≈Çca w Witaminƒô A, niezbƒôdnƒÖ do ochrony sk√≥ry przed s≈Ço≈Ñcem i utrzymania zdrowej opalenizny." },
            { name: "Cukinia i Bazylia (Lekkostrawny)", ingredients: "Cukinia (ugotowana lub surowa), Bazylia, Jogurt Naturalny, 1/2 Brzoskwini.", focus: "Lekkostrawny", nutritionalBenefit: "**Cukinia** to jeden z najbardziej lekkostrawnych sk≈Çadnik√≥w, bogaty w wodƒô i potas. Idealny dla wra≈ºliwego ≈ºo≈ÇƒÖdka w upalne dni. **Bazylia** dodaje ≈õwie≈ºo≈õci i dzia≈Ça antybakteryjnie." },
            { name: "Og√≥rkowo-Koperkowy Ch≈Çodnik", ingredients: "Og√≥rek, Koperek, Kefir/Jogurt, 1/2 Jab≈Çka.", focus: "Ch≈Çodzenie", nutritionalBenefit: "Zawiera du≈ºƒÖ ilo≈õƒá wody i **Potasu**, co pomaga w regulacji p≈Çyn√≥w i zapobieganiu skurczom w upale. **Koperek** wspomaga trawienie." },
            { name: "Brzoskwiniowy Probiotyk", ingredients: "Brzoskwinia, Jogurt naturalny, Nasiona Chia, Woda.", focus: "Jelita", nutritionalBenefit: "**Brzoskwinia** dostarcza ≈Çagodnego b≈Çonnika i Witaminy C. Po≈ÇƒÖczenie z **Jogurtem** (probiotyki) i **Chia** (prebiotyki) wzmacnia mikrobiom jelitowy." },
            { name: "Moc Witamin z Kalarepy", ingredients: "Kalarepa, Zielone Jab≈Çko, Szpinak, Sok z Limonki.", focus: "Witaminy", nutritionalBenefit: "**Kalarepa** jest bogata w **Witaminƒô B6** i b≈Çonnik. To rzadziej u≈ºywany w koktajlach, ale bardzo warto≈õciowy sk≈Çadnik krzy≈ºowy, wspomagajƒÖcy zdrowie p≈Çuc." },
            { name: "Wyb√≥r Tygodnia (Dzie≈Ñ Wolny)", ingredients: "Wybierz dowolny ulubiony koktajl z kwarta≈Çu 3.", focus: "Regeneracja", nutritionalBenefit: "Dzie≈Ñ swobodnego wyboru. W lecie, skup siƒô na koktajlach z wysokƒÖ zawarto≈õciƒÖ wody (Arbuz, Og√≥rek) i antyoksydant√≥w (Jagody, Morele)." },
        ]; // 14 unikalnych

        // Kwarta≈Ç 4: JESIE≈É (Sierpie≈Ñ - Pa≈∫dziernik) - Cel: Stabilizacja
        const JESIEN = [
            { name: "Pumpkin Spice Protein", ingredients: "Puree z Dyni (ugotowanej), Cynamon, Ga≈Çka Muszkato≈Çowa, Mleko, Od≈ºywka Bia≈Çkowa.", focus: "Bia≈Çko/W≈Ç√≥kno", nutritionalBenefit: "**Dynia** jest doskona≈Çym ≈∫r√≥d≈Çem **b≈Çonnika** i beta-karotenu. RozgrzewajƒÖce przyprawy (Cynamon, Ga≈Çka) regulujƒÖ poziom cukru, a bia≈Çko buduje masƒô i syci." },
            { name: "Jab≈Çkowo-Gruszkowa Witalno≈õƒá", ingredients: "Jab≈Çko, Gruszka, P≈Çatki Owsiane, Jogurt Naturalny, Imbir.", focus: "B≈Çonnik", nutritionalBenefit: "**Jab≈Çka** (pektyny) i **Gruszki** to b≈Çonnik, kt√≥ry wspiera zdrowie serca i reguluje wypr√≥≈ºnienia. To klasyczny, rozgrzewajƒÖcy zestaw idealny na jesie≈Ñ." },
            { name: "Orzechowa Moc z Datami", ingredients: "Daktyle, Mas≈Ço Orzechowe, Szpinak, Mleko, Cynamon.", focus: "Energia", nutritionalBenefit: "**Daktyle** to szybkie, naturalne ≈∫r√≥d≈Ço energii i magnezu. Po≈ÇƒÖczenie z **Mas≈Çem Orzechowym** zapewnia zdrowe t≈Çuszcze, kt√≥re sƒÖ magazynowane na zimƒô." },
            { name: "≈ªurawina na Uk≈Çad Moczowy", ingredients: "≈ªurawina (≈õwie≈ºa/mro≈ºona), Banan, Sok z Pomara≈Ñczy, Woda.", focus: "Zdrowie Moczowe", nutritionalBenefit: "**≈ªurawina** zawiera proantocyjanidyny, kt√≥re zapobiegajƒÖ przyleganiu bakterii do ≈õcian dr√≥g moczowych. To najlepsza naturalna ochrona w okresie przej≈õciowym." },
            { name: "Batat Kremowy (Wƒôglowodany)", ingredients: "Ugotowany Batat, Mleko, Cynamon, Ekstrakt Waniliowy.", focus: "Wƒôglowodany", nutritionalBenefit: "**Bataty** to z≈Ço≈ºone wƒôglowodany, kt√≥re dostarczajƒÖ sta≈Çej, d≈Çugotrwa≈Çej energii. SƒÖ bogate w **Witaminƒô A** (beta-karoten) i majƒÖ niski ≈Çadunek glikemiczny." },
            { name: "Czekolada i Orzechy W≈Çoskie (M√≥zg)", ingredients: "Kakao Naturalne, Orzechy W≈Çoskie, Banan, Mleko Migda≈Çowe.", focus: "Omega-3", nutritionalBenefit: "**Orzechy W≈Çoskie** to najlepsze ro≈õlinne ≈∫r√≥d≈Ço **kwas√≥w Omega-3** (ALA), wspierajƒÖcych funkcje m√≥zgu i pamiƒôƒá. **Kakao** jest bogate we flawonoidy, poprawiajƒÖce przep≈Çyw krwi do m√≥zgu." },
            { name: "Ostatni Jarmu≈º Sezonu", ingredients: "Jarmu≈º, Winogrona, Awokado, Siemiƒô Lniane.", focus: "Detoks", nutritionalBenefit: "**Jarmu≈º** dostarcza Witamin A, K i C. Mimo, ≈ºe to jesie≈Ñ, warto nadal oczyszczaƒá organizm, a **Awokado** zapewnia przyswajanie witamin rozpuszczalnych w t≈Çuszczach." },
            { name: "Seler Naciowy i Gorzkie Grejpfruty", ingredients: "Seler Naciowy, Grejpfrut, Woda, 1/2 Jab≈Çka.", focus: "Trawienie", nutritionalBenefit: "Gorzka **Naringenina** z Grejpfruta stymuluje wydzielanie sok√≥w trawiennych. **Seler Naciowy** jest niskokaloryczny i bogaty w b≈Çonnik, wspomagajƒÖc oczyszczanie." },
            { name: "Granat i Kokos (Antyoksydanty)", ingredients: "Pestki Granatu, Mleko Kokosowe, 1/2 Banana.", focus: "Antyoksydanty", nutritionalBenefit: "**Granat** jest jednym z najsilniejszych antyoksydant√≥w (punikalagina), kt√≥ry wspiera zdrowie serca i uk≈Çad krƒÖ≈ºenia. **Kokos** dostarcza t≈Çuszczy dla energii." },
            { name: "Koktajl z P≈Çatkami Owsianymi (Syto≈õƒá)", ingredients: "P≈Çatki Owsiane, Woda, Mas≈Ço Orzechowe, 1/2 Banana, Od≈ºywka Bia≈Çkowa.", focus: "Syto≈õƒá", nutritionalBenefit: "Idealna r√≥wnowaga **b≈Çonnika**, **bia≈Çka** i **zdrowych t≈Çuszcz√≥w**, zapewniajƒÖca uczucie syto≈õci na d≈Çugie godziny i minimalizujƒÖca jesienne podjadanie." },
            { name: "Korze≈Ñ Pietruszki i Jab≈Çko", ingredients: "Ugotowany Korze≈Ñ Pietruszki, Jab≈Çko, Sok z Cytryny, Imbir.", focus: "Wzmocnienie", nutritionalBenefit: "**Korze≈Ñ Pietruszki** ma dzia≈Çanie diuretyczne (moczopƒôdne) i jest bogaty w Witaminƒô C. Wspiera oczyszczanie nerek i pƒôcherza przed zimƒÖ." },
            { name: "Kremowy Ser Twarogowy i ≈öliwka", ingredients: "Ser Twarogowy (bia≈Çko), ≈öliwki (mro≈ºone), Mleko, Cynamon.", focus: "Bia≈Çko", nutritionalBenefit: "**Ser Twarogowy** to kazeina, bia≈Çko wolnowch≈Çanialne, kt√≥re jest idealne na wiecz√≥r lub dla utrzymania sta≈Çego poziomu aminokwas√≥w. **≈öliwki** zawierajƒÖ b≈Çonnik i sorbitol (poprawa trawienia)." },
            { name: "Nasiona S≈Çonecznika i P≈Çatki", ingredients: "Nasiona S≈Çonecznika (namoczone), P≈Çatki Owsiane, 1/2 Gruszki, Mleko.", focus: "T≈Çuszcze", nutritionalBenefit: "**Nasiona S≈Çonecznika** sƒÖ ≈õwietnym ≈∫r√≥d≈Çem **Witaminy E**, silnego antyoksydantu chroniƒÖcego kom√≥rki oraz zdrowych t≈Çuszcz√≥w nienasyconych. Idealne na sk√≥rƒô w ch≈Çodniejsze dni." },
            { name: "Wyb√≥r Tygodnia (Dzie≈Ñ Wolny)", ingredients: "Wybierz dowolny ulubiony koktajl z kwarta≈Çu 4.", focus: "Regeneracja", nutritionalBenefit: "Dzie≈Ñ swobodnego wyboru. JesieniƒÖ skup siƒô na od≈ºywczych, sycƒÖcych koktajlach z du≈ºƒÖ zawarto≈õciƒÖ b≈Çonnika, bia≈Çka i zdrowych t≈Çuszcz√≥w, by przygotowaƒá organizm na zimƒô." },
        ]; // 14 unikalnych

        const QUARTERS = [
            { id: 'ZIMA', name: 'ZIMA (Listopad - Stycze≈Ñ)', days: 91, recipes: ZIMA, color: 'bg-indigo-600', border: 'border-indigo-600', challenge: 'Cel: Wzmocnienie Odporno≈õci (Min. 80% koktajli z Imbirem/KurkumƒÖ/Wit. C)' },
            { id: 'WIOSNA', name: 'WIOSNA (Luty - Kwiecie≈Ñ)', days: 91, recipes: WIOSNA, color: 'bg-lime-600', border: 'border-lime-600', challenge: 'Cel: Wiosenne Oczyszczanie (Min. 70% dni Zielony Detoks)' },
            { id: 'LATO', name: 'LATO (Maj - Lipiec)', days: 91, recipes: LATO, color: 'bg-sky-500', border: 'border-sky-500', challenge: 'Cel: Nawodnienie i Energia (Codziennie sprawdzaj kolor moczu!)' },
            { id: 'JESIEN', name: 'JESIEN (Sierpie≈Ñ - Pa≈∫dziernik)', days: 92, recipes: JESIEN, color: 'bg-amber-600', border: 'border-amber-600', challenge: 'Cel: Stabilizacja i Magazynowanie (Skup siƒô na zdrowych t≈Çuszczach i b≈Çonniku)' },
        ];
        
        // Tablica wszystkich klas ramki, aby je p√≥≈∫niej usunƒÖƒá
        const ALL_BORDER_CLASSES = QUARTERS.map(q => q.border);


        // --- Generowanie Ca≈Çego Planu (365 Dni) ---
        const SHAKE_PLAN = [];
        let dayCounter = 1;

        QUARTERS.forEach(quarter => {
            for (let i = 0; i < quarter.days; i++) {
                const cycleIndex = i % quarter.recipes.length;
                const recipe = quarter.recipes[cycleIndex];
                SHAKE_PLAN.push({
                    day: dayCounter,
                    quarter: quarter.id,
                    quarterName: quarter.name,
                    recipeName: recipe.name,
                    ingredients: recipe.ingredients,
                    focus: recipe.focus,
                    nutritionalBenefit: recipe.nutritionalBenefit, // Dodana nowa warto≈õƒá
                    cycleDay: cycleIndex + 1,
                    cardBorder: quarter.border,
                    cardColorClass: quarter.color, 
                });
                dayCounter++;
            }
        });

        // --- ZarzƒÖdzanie Stanem Lokalnym ---
        const COMPLETION_KEY = 'shake365_completed_days_v2'; 
        let completedDays = {}; 
        let currentFilterId = 'ALL'; 

        function loadProgress() {
            const storedProgress = localStorage.getItem(COMPLETION_KEY);
            if (storedProgress) {
                try {
                    completedDays = JSON.parse(storedProgress);
                } catch (e) {
                    console.error("B≈ÇƒÖd parsowania localStorage:", e);
                    completedDays = {};
                }
            }
        }

        function saveProgress() {
            localStorage.setItem(COMPLETION_KEY, JSON.stringify(completedDays));
        }

        // --- Funkcje Daty i Dnia Roku ---
        
        function getDayOfYear(date) {
            // Uwzglƒôdnienie roku przestƒôpnego. Dni roku sƒÖ liczone od 1 stycznia.
            const start = new Date(date.getFullYear(), 0, 0);
            const diff = (date - start) + ((start.getTimezoneOffset() - date.getTimezoneOffset()) * 60 * 1000);
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        }

        function getTodayShakeDay() {
            return getDayOfYear(new Date());
        }

        function getQuarterFromDay(dayNumber) {
            // W dniach przestƒôpnych (dzie≈Ñ 366) ten kod nadal bƒôdzie dzia≈Ça≈Ç poprawnie 
            // zak≈ÇadajƒÖc, ≈ºe dodatkowy dzie≈Ñ zostanie przypisany do JESIENI (ostatniego kwarta≈Çu)
            // 91 + 91 + 91 + 92 = 365 (standard)
            // 91 + 91 + 91 + 93 = 366 (przestƒôpny)
            if (dayNumber >= 1 && dayNumber <= 91) return 'ZIMA';
            if (dayNumber >= 92 && dayNumber <= 182) return 'WIOSNA';
            if (dayNumber >= 183 && dayNumber <= 273) return 'LATO';
            return 'JESIEN';
        }
        
        // --- Funkcje UI i Logika ---

        window.setCurrentFilter = (filterId) => {
            currentFilterId = filterId;
            renderPlan(false); // Nie przewijaj przy zmianie filtra
        }

        window.toggleCompletion = function(day, event) {
            event.stopPropagation();

            const dayKey = String(day);

            if (completedDays[dayKey]) {
                delete completedDays[dayKey];
            } else {
                completedDays[dayKey] = true;
            }

            saveProgress();
            renderPlan(false); 
        }
        
        // --- Modal Funkcje (Bez alert/confirm) ---

        const modal = document.getElementById('custom-modal');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');

        window.closeModal = function() {
            modal.classList.add('hidden');
            modalConfirmBtn.onclick = null; 
        }

        window.confirmReset = function() {
            document.getElementById('modal-title').textContent = "Potwierd≈∫ Reset";
            document.getElementById('modal-message').textContent = "Czy na pewno chcesz zresetowaƒá postƒôpy wszystkich 365 dni? Dane ZOSTANƒÑ trwale usuniƒôte z Twojej przeglƒÖdarki.";
            
            modalConfirmBtn.textContent = "Resetuj";
            modalConfirmBtn.className = 'px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors';
            
            modalConfirmBtn.onclick = function() {
                resetProgress();
                closeModal();
            };

            modal.classList.remove('hidden');
        }

        function resetProgress() {
            completedDays = {};
            saveProgress();
            renderPlan(true); 
        }
        
        function updateProgressDisplay() {
            const totalDays = SHAKE_PLAN.length;
            const completedCount = Object.keys(completedDays).length;
            const percentage = totalDays > 0 ? ((completedCount / totalDays) * 100).toFixed(1) : 0;
            
            const progressEl = document.getElementById('progress-display');
            progressEl.innerHTML = `Uko≈Ñczone: <span class="text-white font-bold">${completedCount}</span> z ${totalDays} dni | Postƒôp Og√≥lny: <span class="text-white font-bold">${percentage}%</span>`;
        }
        
        function updateQuarterChallenge() {
            // Domy≈õlnie bierzemy kwarta≈Ç dzisiejszego dnia, chyba ≈ºe jest aktywny filtr
            let targetQuarterId = getQuarterFromDay(getTodayShakeDay());
            if (currentFilterId !== 'ALL') {
                targetQuarterId = currentFilterId;
            }
            
            const quarterData = QUARTERS.find(q => q.id === targetQuarterId);
            
            if (!quarterData) return;
            
            const totalQuarterDays = quarterData.days;
            
            // Liczenie uko≈Ñczonych dni w danym kwartale
            const completedInQuarter = SHAKE_PLAN.filter(item => 
                item.quarter === targetQuarterId && completedDays[String(item.day)]
            ).length;
            
            const quarterPercentage = (completedInQuarter / totalQuarterDays) * 100;
            const percentageText = quarterPercentage.toFixed(1) + '%';
            
            const isCompleted = quarterPercentage >= 100;

            const challengeHtml = `
                <p class="text-xs font-semibold uppercase text-gray-500 mb-2">Aktualne Wyzwanie: ${quarterData.name}</p>
                <h3 class="text-lg font-bold text-gray-800 mb-3">${quarterData.challenge}</h3>
                
                <div class="flex justify-between items-center text-sm font-medium mb-1">
                    <span class="${isCompleted ? 'text-green-600 font-bold' : 'text-gray-700'}">${isCompleted ? '‚≠ê CEL OSIƒÑGNIƒòTY!' : 'Postƒôp Kwarta≈Çu: ' + percentageText}</span>
                    <span class="text-gray-500">${completedInQuarter}/${totalQuarterDays} dni</span>
                </div>

                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div class="${isCompleted ? 'bg-green-600' : quarterData.color} h-3 rounded-full transition-all duration-700 ease-out" style="width: ${percentageText}"></div>
                </div>
            `;
            
            document.getElementById('challenge-display').innerHTML = challengeHtml;
            
            // Poprawne usuwanie i dodawanie klas ramki nag≈Ç√≥wka wyzwania
            document.getElementById('challenge-display').classList.remove(...ALL_BORDER_CLASSES);
            document.getElementById('challenge-display').classList.add(quarterData.border.replace('border-', 'border-t-'));
        }

        // G≈Ç√≥wna funkcja renderujƒÖca plan
        function renderPlan(scrollToToday = false) {
            const listElement = document.getElementById('shake-list');
            const quarterButtonsContainer = document.getElementById('quarter-buttons');
            const todayShakeDay = getTodayShakeDay();
            listElement.innerHTML = '';
            quarterButtonsContainer.innerHTML = '';
            
            // 1. Ustawienie filtra i statusu
            
            const filterStatusEl = document.getElementById('filter-status');
            let initialQuarterForScroll = getQuarterFromDay(todayShakeDay);
            
            if (currentFilterId === 'ALL') {
                filterStatusEl.textContent = `Poka≈º wszystkie ${SHAKE_PLAN.length} dni.`;
            } else {
                const quarterName = QUARTERS.find(q => q.id === currentFilterId).name;
                filterStatusEl.textContent = `Filtrowanie: ${quarterName}`;
                // Je≈õli jest aktywny filtr, nie przewijamy, chyba ≈ºe jest to filtr dzisiejszego kwarta≈Çu
                if (currentFilterId !== initialQuarterForScroll) {
                    scrollToToday = false; 
                }
            }

            // 2. Renderowanie przycisk√≥w kwarta≈Ç√≥w + przycisk "Wszystkie"
            
            const allButton = document.createElement('button');
            allButton.textContent = 'Wszystkie';
            allButton.className = `flex-1 p-3 rounded-xl text-sm font-bold transition duration-200 shadow-md transform hover:scale-[1.03] ${
                currentFilterId === 'ALL' ? 'bg-emerald-600 text-white ring-2 ring-offset-2 ring-emerald-500 ring-opacity-50' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
            }`;
            allButton.onclick = () => setCurrentFilter('ALL');
            quarterButtonsContainer.appendChild(allButton);
            
            QUARTERS.forEach(q => {
                const isActive = q.id === currentFilterId;
                const button = document.createElement('button');
                button.textContent = q.name.split(' ')[0];
                button.className = `flex-1 p-3 rounded-xl text-sm font-bold transition duration-200 shadow-md transform hover:scale-[1.03] ${
                    isActive ? `${q.color} text-white ring-2 ring-offset-2 ring-emerald-500 ring-opacity-50` : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`;
                button.onclick = () => setCurrentFilter(q.id);
                quarterButtonsContainer.appendChild(button);
            });
            
            updateProgressDisplay();
            updateQuarterChallenge();


            // 3. Filtrowanie i renderowanie koktajli
            let filteredPlan = SHAKE_PLAN;
            if (currentFilterId !== 'ALL') {
                filteredPlan = SHAKE_PLAN.filter(item => item.quarter === currentFilterId);
            }
            
            let elementToScrollTo = null;

            filteredPlan.forEach(item => {
                const isCompleted = !!completedDays[String(item.day)];
                const isToday = item.day === todayShakeDay;
                
                const card = document.createElement('div');
                card.id = `day-card-${item.day}`;
                
                // Ustawienie klas dla karty
                let cardClasses = `shake-card bg-white rounded-xl overflow-hidden transition-all duration-300 mb-4 shadow-md cursor-pointer border-l-4 border-opacity-0 hover:shadow-xl`;
                
                // Klasy dla dzisiejszego dnia
                if (isToday) {
                    cardClasses = `${cardClasses} today border-l-0 ${item.cardBorder}`;
                } else if (isCompleted) {
                    cardClasses = `${cardClasses} completed border-l-4 border-opacity-70 ${item.cardBorder.replace('border-', 'border-l-')}`;
                } else {
                    cardClasses = `${cardClasses} hover:border-l-4 hover:border-opacity-100 ${item.cardBorder.replace('border-', 'hover:border-')}`;
                }

                // Domy≈õlnie otw√≥rz dzisiejszy koktajl
                const isInitiallyOpen = isToday;
                if (isInitiallyOpen) {
                    cardClasses += ' open';
                    elementToScrollTo = card;
                }
                
                card.className = cardClasses;

                card.innerHTML = `
                    <div class="day-header flex justify-between items-center p-4">
                        <!-- G≈Ç√≥wna zawarto≈õƒá -->
                        <div class="flex-1 min-w-0 pr-4" onclick="this.closest('.shake-card').classList.toggle('open')">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="text-xs font-mono text-gray-500 leading-none">${item.quarterName.split('(')[0].trim()} | Dzie≈Ñ ${item.day}</span>
                                ${isToday ? '<span class="px-2 py-0.5 text-xs font-bold rounded-full bg-emerald-500 text-white shadow-md">DZI≈ö</span>' : ''}
                                <span class="px-2 py-0.5 text-xs font-semibold rounded-full text-white ${item.cardColorClass}">${item.focus}</span>
                            </div>
                            <h2 class="text-lg font-extrabold text-gray-800 leading-tight">${item.recipeName}</h2>
                        </div>
                        
                        <!-- Checkbox -->
                        <div class="flex-shrink-0">
                             <label class="checkbox-container">
                                <input type="checkbox" ${isCompleted ? 'checked' : ''} onclick="window.toggleCompletion(${item.day}, event)">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Szczeg√≥≈Çy - domy≈õlnie ukryte -->
                    <div class="shake-details border-t border-gray-100">
                        <p class="text-sm text-gray-600 mb-2">
                            <strong class="font-semibold text-gray-700">Sk≈Çadniki:</strong> ${item.ingredients}
                        </p>
                        <p class="text-xs text-gray-500 p-3 bg-gray-50 rounded-lg border border-gray-100">
                            <strong class="font-bold text-gray-700">Warto≈õƒá i Korzy≈õci:</strong> ${item.nutritionalBenefit}
                        </p>
                    </div>
                `;

                listElement.appendChild(card);
            });
            
            // 4. Przewijanie do aktualnego dnia
            if (scrollToToday && elementToScrollTo) {
                setTimeout(() => {
                    // Przewi≈Ñ do elementu, kt√≥ry jest widoczny w bie≈ºƒÖcym filtrze
                    elementToScrollTo.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        }

        // --- Inicjalizacja Aplikacji ---
        window.onload = function() {
            loadProgress();
            
            const todayShakeDay = getTodayShakeDay();
            const initialQuarter = getQuarterFromDay(todayShakeDay);
            currentFilterId = initialQuarter; // Ustaw domy≈õlny filtr na kwarta≈Ç dzisiejszego dnia
            
            renderPlan(true); 
        };

    </script>
</body>
</html>